<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<script src="https://login.persona.org/include.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
Inloggen op ${application}
<img src="https://developer.mozilla.org/files/3955/email_sign_in_black.png" id="signin"/>
<form method="post">
    <input type="hidden" id="session" name="session"/>
    <input type="submit" value="Post"/>
</form>
<script>
    var signinLink = document.getElementById('signin');
    if (signinLink) {
        signinLink.onclick = function() { navigator.id.request(); };
    }
    navigator.id.watch({
        onlogin: function(assertion) {
            $.ajax({
                type: 'POST',
                url: '/auth/persona',
                data: {assertion: assertion},
                success: function(res, status, xhr) {
                    document.getElementById('session').value = res["session"];
                    alert("Session " + res["session"]);
                },
                error: function(xhr, status, err) {
                    navigator.id.logout();
                    alert("Login failure: " + err);
                }
            });
        },
        onlogout: function() {
        }
    });
</script>
</body>
</html>
